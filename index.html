<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Poverty Under Lula</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""
  />
  <link
    href="http://fonts.googleapis.com/css?family=Lato"
    rel="stylesheet"
    type="text/css"
  />
  <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Cabin:wght@500&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Martel:wght@200&display=swap" rel="stylesheet">

  <style>
    body{ margin: 0px; }
    
    #map {
      background-color:rgb(26, 25, 25);
      float: left;
      width: 65%;
      height: 93vh;
      min-height: 93vh;
      border-top:  3px groove whitesmoke;
      border-bottom: 3px groove whitesmoke;
    }

    #about {
      background-color:rgb(26, 25, 25);
      color: whitesmoke;
      float: right;
      width: calc(35% - 27px);
      height: 93vh;
      min-height: 93vh;
      margin: auto;
      padding: 0px 12px 0px 12px;
      border-top: 3px groove white;
      border-bottom: 3px groove whitesmoke;
      border-left: 3px groove whitesmoke;
      font-family: 'open sans', sans-serif;
      font-size: 15px;
      overflow-y: scroll;
    }

    .textwrap{
      float: right;
margin: 2px 10px 2px 2px;
    }

    .caption{
      font-family: 'Martel', serif;
      font-size: 10.5px;
      padding: 7px 0px 0px 7px
    }

    .caption2{
      font-size: 11px;
      font-family: 'cabin', sans-serif;
      color:rgb(97, 94, 94)
    }

    .h1 {
      height: 6vh;
      width: calc(100%-10px);
      margin:auto;
      padding: 5px 0px 0px 10px;
      background-color:rgb(26, 25, 25);
      color: whitesmoke;
      font-family: 'Cabin', sans-serif;
    }

    .h2 {
      font-family: 'open sans', sans-serif;
      font-weight: normal;
      padding: 0px
    }

    .p {
      font-family: 'lato', sans-serif;
      font-weight: lighter
    }

    /* Small devices (landscape phones, 576px and up) */
    @media (min-width: 576px) {
    }

    /* Medium devices (tablets, 768px and up) */
    @media (min-width: 768px) {
      #map {
        height: 60vh;
      }
    }

    /* Large devices (desktops, 992px and up) */
    @media (min-width: 992px) {

      #map {
        height: 80vh;
      }
    }

    /* Extra large devices (large desktops, 1200px and up) */
    @media (min-width: 1200px) {}

    .legend {
        /* padding: 0px 0px; */
        font-size: 1em;
        background: rgba(17, 17, 17, 0.8);
        color: whitesmoke;
        box-shadow: 2px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        width: 180px;
    }

    .legend h3 {
        font-size: 1.3em;
        font-family: 'cabin', sans-serif;
        font-weight: bold;
        line-height: 1em;
        color: whitesmoke;
        margin-left: 20px;
    }

    .legend h3 span {
        font-size: 1.3em;
        margin: 0 20px 0 0;
    }

    .legend ul {
        list-style-type: none;
        padding: 0;
        font-family: 'cabin', sans-serif;
        font-size: 13px;
        margin: 12px 4px 20px 20px;
    }

    .legend li {
        height: 22px;
    }

    .legend span {
        width: 30px;
        height: 20px;
        float: left;
        margin-right: 10px;
    }

    #ui-controls {
        width: 176px;
        margin: 0px 10px 10px 0px;
        padding: 8px 25px 8px 15px;
        background: rgba(17, 17, 17, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        color: whitesmoke;
    }

    #ui-controls .min {
        float: left;
    }

    #ui-controls .max {
        float: right;
        margin-right: -15px;
    }

    .year-slider {
        width: 100%;
    }

    label {
        font-size: 1.3em;
        font-family: 'cabin', sans-serif;
        font-weight: bold;
    }
  </style>

</head>

<body>

  <div class="container-fluid">
    <header>
      <div>
        <h1 class="h1">Here's how far poverty fell in Brazil under President Lula da Silva</h1>
      </div>
    </header> 

    <section>
      <div>
        <div id="map"></div>
        <div id="ui-controls">
          <label>
            <span class="min">2003</span>
            <span class="max">2010</span>
            <input
              type="range"
              min="2003"
              max="2010"
              value="2003"
              step="1"
              class="year-slider"
            />
          </label>
        </div>
      </div>
      <aside id="about">
        <section>
          <h2 class="h2">HOW IT HAPPENED</h2>
          <p class="p" > Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et, sskjdsn kdjedii xjdndjxndxbjd d x jxj skn kneke xn jxenen Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et, smaodln sjej nndndn djd lorem ipsum samom dalom lorem ipsom</p>
          <img class="textwrap" src="graphics/lula-ricardoStuckert.png" width="350"alt="Pro-Lula Rally">
          <!-- <div class="caption">Lula's supporters take to the streets following his <br>arrest during the 2018 election.<br><span class="caption2">Photo by Ricardo Stuckert. Licensed by Creative Commons</span></div> -->
          <p class="p">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,j Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet,</p><p class="p"> Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,</p> consectetur adipiscing elit. Nam id purus finibus, venenatis ligula et,Lorem ipsum dolor sit amet, consectetur adipiscing elit. </p>
        </section>
      </aside>
    </section>
  </div> 


  <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
  
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" 
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

  <script> src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js"</script>

  <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
  <script>
// map options
      let parsedData;

      function getPopulation(region, year) {
        for (let row of parsedData) {
          if (row["Region"] === region) {
            return row[year.replace('poverty-', 'pop')];
          }
        }
      }

      function sparkline(rates) {
        $('.dynamicsparkline').sparkline(rates);
      }

      const options = {
        scrollWheelZoom: false,
        zoomSnap: 0.2,
        dragging: false,
        zoomControl: true,
      };

      // create the Leaflet map
      const map = L.map("map", options);

      // AJAX request for GeoJSON data
      $.getJSON("data/brazil-states.json", function (states) {
        Papa.parse("data/brazil-poverty-and-pop.csv", {
          download: true,
          header: true,
          complete: function (data) {
            processData(states, data);
          },
        });
      });

      function processData(states, data) {
        parsedData = data.data;

        // loop through all the states
        for (let i of states.features) {
          // for each of the CSV data rows
          for (let j of data.data) {
            // if the state fips code and data fips code match
            if (i.properties.ADM1_PT === j.Region) {
              // re-assign the data for that state as the state's props
              i.properties = j;

              // no need to keep looping, break from inner loop
              break;
            }
          }
        }

        // empty array to store all the data values
        const rates = [];

        // iterate through all the states
        states.features.forEach(function (state) {
          // iterate through all the props of each state
          for (const prop in state.properties) {
            // if the attribute is a number and not one of the fips codes or name
            if (prop == 'poverty-2003') {
              // push that attribute value into the array
              rates.push(Number(state.properties[prop]));
            }
          }
        });
        // create class breaks
        var breaks = [0,1,5,10,15,20,33];
        var colorHex = ['#eff3ff','#c6dbef','#9ecae1','#6baed6','#3182bd','#08519c'];

        // create color generator function
        var colorize = chroma
          .scale(colorHex).classes(breaks)
          .mode("lab");

        drawMap(states, colorize);
        drawLegend(breaks, colorize);
      }

      function drawMap(states, colorize) {
        // create Leaflet object with geometry data and add to map
        const dataLayer = L.geoJson(states, {
          style: function (feature) {
            return {
              color: "whitesmoke",
              weight: 1.5,
              fillOpacity: 1,
              fillColor: "#ffffff",
            };
          },
          // add hover/touch functionality to each feature layer
          onEachFeature: function (feature, layer) {
            layer.on("mouseover", function () {
              layer
                .setStyle({
                  color: "yellow",
                  weight: 3
                })
                .bringToFront();
            });

            // on mousing off layer
            layer.on("mouseout", function () {
              // reset the layer style
              layer.setStyle({
                color: "whitesmoke",
                weight: 1.5
              });
            });
          },
        }).addTo(map);

        // first set the zoom/center to the dataLayer's extent
        map.fitBounds(dataLayer.getBounds());

        //create slider UI
        createSliderUI(dataLayer, colorize);

        //initially color map with first timestamp
        updateMap(dataLayer, colorize, "poverty-2003");
      } //end drawMap

      function updateMap(dataLayer, colorize, currentYear, rates) {
        // loop through each layer
        dataLayer.eachLayer(function (layer) {
          //shorthand for properties
          const props = layer.feature.properties;

          //update color to match timestamp
          layer.setStyle({
            fillColor: colorize(Number(props[currentYear])),
          });

          //build tooltip
          const tooltip = `<b>${props["Region"]}</b><br />
            ${props[currentYear]}% in poverty<br />
            Population: ${getPopulation(props["Region"], currentYear)} million<br />
            Trend: class= "dynamicsparkline"`

          //bind tooltip to layer
          layer.bindTooltip(tooltip, {
            sticky: true,
          });
        });
      } // end updateMap

      function drawLegend(breaks, colorize) {
        // create a Leaflet control for the legend
        const legendControl = L.control({
          position: "bottomleft",
        });

        // when the control is added to the map
        legendControl.onAdd = function (map) {
          // create a new division element with class of 'legend' and return
          const legend = L.DomUtil.create("div", "legend");
          return legend;
        };

        // add the legend control to the map
        legendControl.addTo(map);

        const legend = $(".legend").html(
          "<H3><span>2003</span> <br> <br> Percent in extreme poverty </H3><ul>"
        );

        //loop through the break values
        for (let i = 0; i < breaks.length - 1; i++) {
          //access color for each class range
          const color = colorize(breaks[i]);

          //build a list item with color blocks and values
          const classRange = `<li><span style="background:${color}"></span>
                              ${breaks[i].toLocaleString()}% &mdash;
                              ${breaks[i + 1].toLocaleString()}%</li>`;

          //append the list item to the list
          $(".legend ul").append(classRange);
        }

        //close unorderdered list
        // legend.append("</ul>");
      } // end drawLegend()

      function createSliderUI(dataLayer, colorize) {
        const sliderControl = L.control({ position: "bottomright" });
        //when added to the map
        sliderControl.onAdd = function (map) {
          //create leaflet control for the slider
          const slider = L.DomUtil.get("ui-controls");

          //disable scrolling of map while using controls
          L.DomEvent.disableScrollPropagation(slider);

          //disable click events while using controls
          L.DomEvent.disableClickPropagation(slider);

          //return the slider from the onAdd method
          return slider;
        };

        // Add the control to the map
        sliderControl.addTo(map);

        // select the form event
        $(".year-slider").on("input change", function () {
          //when user changes
          const currentYear = $(this).val(); //update the year
          updateMap(dataLayer, colorize, `poverty-${currentYear}`); // update the map with current timestamp
          $(".legend H3 span").html(currentYear); // update timestamp in legend heading
        });
      } // end createSliderUI()
    
  </script>
</body>

</html>